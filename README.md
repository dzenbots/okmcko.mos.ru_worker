# Получение документов, размещаемых на сайте okmcko.mos.ru (ЭЖД &rarr; Организация образования &rarr; Внешняя оценка )

### Суть реализации: Получить ссылки на диагностику как только они появятся в ЛК МЦКО школы и не в pdf формате с ненужными нам данными детей а только целевые данные: ссылка на диагностику и для какого она кабинета. Ну и допом есть функционал оперативного получения вообще всех новых документов из этого хранилища

1. [Установка](#установка)
2. [Предварительная настройка параметров в .env.dist](#предварительная-настройка) 
3. [Запуск](#запуск)

---

## Установка

    При написании использовался Python 3.13
    Не буду описывать как создавать Telegram бота, информации полно на просторах чебурнета

1. Качаем репозиторий:
    ```shell
    git clone https://github.com/dzenbots/okmcko.mos.ru_worker.git
    ```
2. Создаем вирутальное окружение, активируем его и устанавливаем зависимости:
    
    - для CMD:
    ```cmd
    python -m venv .venv
    .\venv\scripts\activate.bat
    pip install -r requirements.txt
    ```
    - для Powershell 
    ```powershell
    python -m venv .venv
    .\venv\scripts\activate.ps1
    pip install -r requirements.txt
    ```
    - для Bash (Linux) 
    ```shell
    python -m venv .venv
    ./venv/bin/activate
    pip install -r requirements.txt
    ```
   
3. Устанавливаем драйвер браузера для Playwright

    ```shell
    playwright install chromium
    ```
   
## Предварительная настройка параметров в [.env.dist](.env.dist)

Переименовываем (или копируем) файл `.env.dist` в `.env`

Заполняем переменные своими данными:

| Переменная        | Значение                                                                                                                                            |
|:------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------|
| LOGIN             | Логин mos.ru пользователя, имеющего права на вкладку Организация обучения                                                                           | 
| PASSWORD          | Пароль mos.ru пользователя, имеющего права на вкладку Организация обучения                                                                          |
| DWNLD_DIR_PATH    | Путь к локальной папке, куда будут скачиваться файлы из Внешней оценки                                                                              |
| MCKO_BOT_TOKEN    | Токен вашего Telegram-бота, с помощью которого будут отправляться ссылки для диагностики в чат                                                      |
| CHAT_ID           | ID чата куда отправлять ссылки диагностики. Если будете отправлять в группу, то добавьте в начало `-100`                                            |
| MESSAGE_THREAD_ID | Если в группе есть топики, то здесь можно указать ID топика. Если топика нет, удалите строку с этой переменной                                      |
| SMTP_SERVER       | Сервер для работы с почтой (у Яндекса smtp.yandex.ru)                                                                                               |
| SMTP_PORT         | Порт почтового сервера (у Яндекса 465)                                                                                                              |
| SMTP_LOGIN        | Почтовый адрес, с которого будет отправляться сообщение с файлом из МЦКО                                                                            |
| SMTP_PASSWORD     | Пароль почтового ящика, который выше. Возможно понадобится создать пароль для внешнего приложения и указывать именно его (у Яндекса это точно надо) |
| TARGET_EMAIL      | Почтовый адрес, куда отправить сообщение с файлом из МЦКО. Можно указать один адрес рассылки с нужными сотрудниками                                 |
| DEBUG             | `True` или `False` в зависимости от того, хотите ли вы наблюдать как там в браузере происходит переход по страницам и скачивание файлов             |


## Запуск

При активированном виртуальном окружении запускаем командой

```shell
python main.py
```
> [!NOTE] 
> Для минимизации спама на почту и в TG-чат софтина смотрит только первые 10 строк таблицы с документами в МЦКО. Далее при появлении новых документов скачивает только их. Но при первом запуске, естественно, все 10 документов будут новыми.


